<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Tesla Entertainment</title>
    <link rel="stylesheet" href="Tesla_Design_Anna.css">
</head>

<body>
    <header>
        <button id="buttonHome" class="headerInformation">
            <img src="Home.png" width="53" height="50">
        </button>
        <div id="date" class="headerInformation"></div>
        <div id="logo" class="headerInformation">
            <img src="Logo.png" width="85" height="80"> <!-- Proportion 1,0575-->
        </div>
        <div id="time" class="headerInformation"></div>
        <div id="temperature" class="headerInformation"></div>
    </header>

    <main>
        <button id="buttonLock" class="statusInformation">
            <img src="lock.png" width="53" height="50" id="locked">
            <img src="unlock.png" width="53" height="50" id="unlocked">
        </button>
        <button id="buttonPressure" class="statusInformation"></button>
        <div class="teslaHome"> <img src="Tesla.png" id="teslaHome" /></div>
        <button id="buttonConsumption" class="statusInformation"></button>
        <button id="buttonSpeed" class="statusInformation"></button>
        <button id="buttonAir" class="statusInformation">Klimaanlage</button>
    </main>

    <footer>
        <div id="title" class="music">♪♫ MUSIK ♪♫</div>
        <div id="musicPlayer" class="music">
            <audio id="audioControls"
                   controls
                   src="Wohin Du Gehst.mp3"
                   type="audio/mp3"></audio>
        </div>
        <div id="musicCover" class="music">COVER</div>
    </footer>

    <script>

        var flagHome = true;
        var flagPressure = false;
        var flagAir = false;

        //Lock and unlock start
        var carLocked = false;
        if (carLocked == true) {
            document.getElementById("locked").style.display = "block";
            document.getElementById("unlocked").style.display = "none";
        } else if (carLocked == false) {
            document.getElementById("locked").style.display = "none";
            document.getElementById("unlocked").style.display = "block";
        }

        //
        window.setInterval(function () {

            //Get Python Service Data
            fetch('http://192.168.0.164:5000/status').then(function (response) {
                response.text().then(function (text) {
                    let actualValues = text.split(/,|:/);

                    if (flagHome == true) {
                        console.log(text);
                        document.getElementById("buttonPressure").innerHTML = "Luftdruck";
                        document.getElementById("buttonConsumption").innerHTML = "Verbrauch: " + actualValues[1].substr(1, 5) + " Liter";
                        document.getElementById("buttonSpeed").innerHTML = "Geschwindigkeit: " + actualValues[7].substr(1, 6) + " km/h";
                    }
                    document.getElementById("temperature").innerHTML = actualValues[9].substr(1, 4) + "°C / " + actualValues[3].substr(1, 5) + "%";

                    if (flagPressure == true) {
                        document.getElementById("frontLeft").innerHTML = Math.round(actualValues[5].substr(1, 4) * 0.99) + " kPa";
                        document.getElementById("frontRight").innerHTML = Math.round(actualValues[5].substr(1, 3) * 0.99) + " kPa";
                        document.getElementById("backLeft").innerHTML = actualValues[5].substr(1, 6) + " kPa";
                        document.getElementById("backRight").innerHTML = actualValues[5].substr(1, 6) + " kPa";
                    }
                });
            });
            document.getElementById("buttonHome").addEventListener("click", ShowTemplate);

            if (flagHome == true) {
                document.getElementById("buttonPressure").addEventListener("click", showPressure);
                document.getElementById("buttonAir").addEventListener("click", templateSlider);
                //Lock and unlock the car
                var carLocked = false;
                if (carLocked == true) {
                    document.getElementById("locked").style.display = "block";
                    document.getElementById("unlocked").style.display = "none";
                } else if (carLocked == false) {
                    document.getElementById("locked").style.display = "none";
                    document.getElementById("unlocked").style.display = "block";
                }
                document.getElementById("buttonLock").addEventListener("click", lockUnlock);
            }
        }, 1000
        );

        //Template BackScreen
        function ShowTemplate() {
            document.querySelector("main").innerHTML = "";
            document.getElementsByTagName("main")[0].appendChild(document.getElementsByClassName("templateHome")[0].content.cloneNode(true));//Clone and open template
            flagPressure = false;
            flagHome = true;
            flagAir = false;
        }

        //Template Pressure
        function showPressure() {
            document.querySelector("main").innerHTML = "";
            document.getElementsByTagName("main")[0].appendChild(
                document.getElementsByClassName("templatePressure")[0].content.cloneNode(true));
            flagPressure = true;
            flagHome = false;
            flagAir = false;
        }

        //Template Air
        function templateSlider() {
            document.querySelector("main").innerHTML = "";
            document.getElementsByTagName("main")[0].appendChild(
                document.getElementsByClassName("templateAir")[0].content.cloneNode(true));
            flagPressure = false;
            flagHome = false;
            flagAir = true;
            if (flagAir == true) {
                showSlider();
            }
        }

        function showSlider() {
            var rangeslider = document.getElementById("sliderRange");
            var output = document.getElementById("demo");
            output.innerHTML = rangeslider.value;
            rangeslider.oninput = function () {
                output.innerHTML = this.value;
            }
        }

        //Lock and unlock the car
        function lockUnlock() {
            carLocked = !carLocked;
            if (carLocked == true) {
                document.getElementById("locked").style.display = "block";
                document.getElementById("unlocked").style.display = "none";
                console.log("if true");
                (fetch('http://192.168.0.164:5000/action/lock').then(function (response) {
                    response.text().then(function (text) {
                    });
                }))
            }
            else if (carLocked == false) {
                document.getElementById("locked").style.display = "none";
                document.getElementById("unlocked").style.display = "block";
                console.log("if false");
                (fetch('http://192.168.0.164:5000/action/unlock').then(function (response) {
                    response.text().then(function (text) {
                    });
                }))
            }
        }
        document.getElementById("buttonLock").addEventListener("click", lockUnlock);

        //Current Time
        function currentTime() {
            var Today = new Date();
            var hoursGet = Today.getHours(); var minutesGet = Today.getMinutes(); var secondsGet = Today.getSeconds();
            var Hours, Minutes, Seconds
            Hours = hoursGet + ":";
            if (minutesGet < 10) { Minutes = '0' + minutesGet + ":"; }
            else { Minutes = minutesGet + ":"; }
            if (secondsGet < 10) { Seconds = '0' + secondsGet; }
            else { Seconds = secondsGet; }
            time.innerHTML = Hours + Minutes + Seconds + " Uhr";
            window.setTimeout("currentTime();", 1000);
        }
        window.onload = currentTime;

        //Current Date
        function getToday() {
            var Today = new Date();
            var Day = Today.getDate(); // Day
            // Months start at 0!
            var Month = Today.getMonth() + 1; // Month
            var Year = Today.getFullYear(); // Year
            if (Day < 10) {
                Day = '0' + day;
            }
            if (Month < 10) {
                Month = '0' + month;
            }
            Today = Day + '.' + Month + '.' + Year;
            return Today;
        }
        document.getElementById("date").textContent = getToday();

    </script>

    <template class="templateHome">
        <button id="buttonLock" class="statusInformation">
            <img src="lock.png" width="53" height="50" id="locked">
            <img src="unlock.png" width="53" height="50" id="unlocked">
        </button>
        <button id="buttonPressure" class="statusInformation"></button>
        <div class="teslaHome"><img src="Tesla.png" id="teslaHome" /></div>
        <button id="buttonConsumption" class="statusInformation"></button>
        <button id="buttonSpeed" class="statusInformation"></button>
        <button id="buttonAir" class="statusInformation">Klimaanlage</button>
    </template>

    <template class="templatePressure">
        <div id="pressureAll">
            <div id="frontLeft" class="carPressure"> vorne links</div>
            <div><img src="TeslaPressure.png" id="Car"></div>
            <div id="frontRight" class="carPressure"> vorne rechts</div>
            <div id="backLeft" class="carPressure"> hinten Links</div>
            <div id="backRight" class="carPressure"> hinten rechts</div>
        </div>
    </template>

    <template class="templateAir">
        <div id="conditioningRange">
            <h1>Bedienung der Klimaanlage</h1>
            <p>Hier können Sie Ihre Wunschtemperatur festlegen:</p>
            <div class="rangeslider">
                <input type="range" min="18" max="26" Value="10"
                       class="myslider" id="sliderRange">
                <p><span id="demo"></span> °C</p>
            </div>
        </div>
    </template>

</body>
</html>